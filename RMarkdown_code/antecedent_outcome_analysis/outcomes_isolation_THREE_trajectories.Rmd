---
title: "Analyses for testing the association betwween isolation trajectories and outcomes - Three trajectories"
author: "Katherine N Thompson"
date: "19th Jan 2021"
output:
  word_document:
    toc: yes
    toc_depth: '2'
  html_document:
    df_print: paged
    toc: yes
    toc_depth: 2
    toc_float:
      collapsed: no
    number_sections: no
    highlight: monochrome
    theme: cerulean
code_folding: hide
---

outcomes_isolation_THREE_trajectories_KT

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      comment = NA,
                      prompt = FALSE,
                      cache = FALSE,
                      message = FALSE,
                      warning = FALSE)

options(bitmapType = 'quartz') # to render fonts better
```

```{r Clear global environment}
remove(list = ls())
```

```{r colour palletes for graphs}
palette2 <- c("#78D9C5","#F5BE5E")
palette2b <- c("#78D9C5","#EEB6E9")
```

```{r Load packages}
library(knitr)
library(summarytools)
library(psych)
library(skimr)
library(ggpubr)
library(tidyr)
library(gplots)
library(Rmisc)
library(MplusAutomation)
library(stringr)
library(stringi)
library(filesstrings)
library(texreg)
library(relimp)
library(nnet)
library(ggplot2)
# load necessary packages for importing the function
library(lmtest) # linear models
library(sandwich)
library(jtools) # glm
library(clusterSEs) #multinomial models

library(tidyverse)
library(dplyr) #conflicts with tidyverse for e.g. rename and row_number
```

```{r source the data file path}
#source raw data directory: data_raw and data included
source("../../../../../isolation_trajectories_data_path.R")
```

# Theme for plotting

```{r theme for all plots}
theme.outcome <- theme(panel.grid.major.x = element_line(size = 0.5,
                                          linetype = 'dashed',
                                          colour = "gray"),
        plot.title = element_text(size = 15, face = "bold", hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.title.x = element_text(size=12,face="bold"),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black", size = 9),
        axis.text.y = element_text(colour = "black", size = 12),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(),
        panel.background = element_blank(),
        legend.position = "bottom",
        strip.text.y = element_blank())
```

# Variable lists

```{r lists for outcome regressions}
outcome.dependent <- c( # mental health
                      "depression_diagnosis_12mo_18", 
                       "depression_current_scale_18",
                       "anxiety_diagnosis_18", 
                       "anxiety_current_scale_18",
                       "ADHD_diagnosis_18", 
                       "inattentive_hyperactive_symptoms_total_18",
                       "conduct_disorder_moderate_18", 
                       "conduct_disorder_symptoms_18", 
                       "alcohol_dependence_18", 
                    #   "alcohol_abuse_18", # using dependence as better representation of severity
                       "alcohol_symptom_scale_18",
                       "cannabis_dependence_18", 
                       "cannabis_symptom_scale_18", 
                       "PTSD_diagnosis_lifetime_18", 
                       "PTSD_diagnosis_current_18", 
                       "cat_psychosis_experiences_scale_18", 
                       "suicide_attempt_selfharm_18", 
                       "service_use_18", 
                      # physical health
                       "BMI_18", 
                       "CRP_log_18",
                       "physical_activity_18",
                       "smoking_current_number_18",
                      # coping and functioning
                       "loneliness_18",
                       "life_satisfaction_18",
                       "technology_use_18",
                       "coping_with_stress_18",
                       "PSQI_global_score_18",
                      # employment
                       "not_in_employment_education_18", 
                       "job_preparedness_skills_18",
                       "job_preparedness_attributes_18",
                       "optimism_18",
                       "job_search_activities_count_18")

outcome.dependent.numeric <- c( # mental health
                               "depression_diagnosis_12mo_numeric_18", 
                               "depression_current_scale_18",
                               "anxiety_diagnosis_numeric_18", 
                               "anxiety_current_scale_18",
                               "ADHD_diagnosis_numeric_18", 
                               "inattentive_hyperactive_symptoms_total_18",
                               "conduct_disorder_moderate_numeric_18", 
                               "conduct_disorder_symptoms_18", 
                               "alcohol_dependence_numeric_18", 
                            #   "alcohol_abuse_numeric_18", 
                               "alcohol_symptom_scale_18",
                               "cannabis_dependence_numeric_18", 
                               "cannabis_symptom_scale_18", 
                               "PTSD_diagnosis_lifetime_numeric_18", 
                               "PTSD_diagnosis_current_numeric_18", 
                               "cat_psychosis_experiences_scale_numeric_18", 
                               "suicide_attempt_selfharm_numeric_18", 
                               "service_use_numeric_18", 
                               "BMI_18", # physical health
                               "CRP_log_18",
                               "physical_activity_18",
                               "smoking_current_number_18",
                               "loneliness_18", # coping and functioning
                               "life_satisfaction_18",
                               "technology_use_18",
                               "coping_with_stress_18",
                               "PSQI_global_score_18",
                               "not_in_employment_education_numeric_18", # employment
                               "job_preparedness_skills_18",
                               "job_preparedness_attributes_18",
                               "optimism_18",
                               "job_search_activities_count_18")

name.list <- c(
              "Depression diagnosis: Yes",
              "Depression symptoms",
              "Anxiety diagnosis: Yes",
              "Anxiety symptoms",
              "ADHD diagnosis: Yes",
              "Inattentive and hyperactive symptoms",
              "Moderate conduct disorder: Yes",
              "Conduct disorder symptoms",
              "Alcohol dependence: Yes",
            #  "Alcohol abuse: Yes",
              "Alcohol dependence symptoms",
              "Cannabis dependence: Yes",
              "Canabis dependence symptoms",
              "PTSD lifetime diagnosis: Yes",
              "PTSD current diagnosis: Yes",
              "Expereinces of psychosis",
              "Suicide attempt: Yes",
              "Service use: Yes",
              "BMI",
              "Log CRP",
              "Physical activity",
              "Daily number of cigarettes smoked",
              "Loneliness",
              "Life satisfaction",
              "Technology use",
              "Coping with stress",
              "PSQI score",
              "Not in employment or education: Yes",
              "Job preparedness: skills",
              "Job preparedness: attributes",
              "Optimism",
              "Job search activities")

outcome.dependent.linear <- c(
  "depression_current_scale_18", # mental health
  "anxiety_current_scale_18",
  "inattentive_hyperactive_symptoms_total_18",
  "conduct_disorder_symptoms_18", 
  "alcohol_symptom_scale_18",
  "cannabis_symptom_scale_18", 
  "cat_psychosis_experiences_scale_numeric_18", # can to be numeric to be in linear regression
  "BMI_18", # physical health
  "CRP_log_18",
  "physical_activity_18",
  "smoking_current_number_18",
  "loneliness_18", #coping and functioning
  "life_satisfaction_18",
  "technology_use_18",
  "coping_with_stress_18",
  "PSQI_global_score_18",
  "job_preparedness_skills_18", #employment
  "job_preparedness_attributes_18",
  "optimism_18",
  "job_search_activities_count_18"
)

outcome.dependent.linear.zscore <- c(
  "z_score.depression_current_scale_18", # mental health
  "z_score.anxiety_current_scale_18",
  "z_score.inattentive_hyperactive_symptoms_total_18",
  "z_score.conduct_disorder_symptoms_18", 
  "z_score.alcohol_symptom_scale_18",
  "z_score.cannabis_symptom_scale_18", 
  "z_score.cat_psychosis_experiences_scale_numeric_18", # can to be numeric to be in linear regression
  "z_score.BMI_18", # physical health
  "z_score.CRP_log_18",
  "z_score.physical_activity_18",
  "z_score.smoking_current_number_18",
  "z_score.loneliness_18", #coping and functioning
  "z_score.life_satisfaction_18",
  "z_score.technology_use_18",
  "z_score.coping_with_stress_18",
  "z_score.PSQI_global_score_18",
  "z_score.job_preparedness_skills_18", #employment
  "z_score.job_preparedness_attributes_18",
  "z_score.optimism_18",
  "z_score.job_search_activities_count_18"     
)

outcome.dependent.linear.name.list <- c(
                                        "Depression symptoms",
                                        "Anxiety symptoms",
                                        "Inattentive and hyperactive symptoms",
                                        "Conduct disorder symptoms",
                                        "Alcohol dependence symptoms",
                                        "Cannabis dependence symptoms",
                                        "Expereinces of psychosis",
                                        "BMI",
                                        "Log CRP",
                                        "Physical activity",
                                        "Daily number of cigarettes smoked",
                                        "Loneliness",
                                        "Life satisfaction",
                                        "Technology use",
                                        "Coping with stress",
                                        "PSQI score",
                                        "Job preparedness: skills",
                                        "Job preparedness: attributes",
                                        "Optimism",
                                        "Job search activities")

outcome.dependent.logistic <- c(
  "depression_diagnosis_12mo_18", # mental health 
  "anxiety_diagnosis_18", 
  "ADHD_diagnosis_18",
  "conduct_disorder_moderate_18",
  "alcohol_dependence_18",
 # "alcohol_abuse_18", 
  "cannabis_dependence_18", 
  "PTSD_diagnosis_lifetime_18", 
  "PTSD_diagnosis_current_18", 
  "suicide_attempt_selfharm_18", 
  "service_use_18",
  "not_in_employment_education_18" #employment
)

outcome.dependent.logistic.name.list <- c(
  "Depression diagnosis",
  "Anxiety diagnosis",
  "ADHD diagnosis",
  "Moderate conduct disorder",
  "Alcohol dependence",
 # "Alcohol abuse",
  "Cannabis dependence",
  "PTSD lifetime diagnosis",
  "PTSD current diagnosis",
  "Suicide attempt",
  "Service use",
  "Not in employment or education"
)
```

# Read in data

```{r read in prepped regression data and check variable names, include=FALSE}
dat <- readRDS(file = paste0(data_path, "class_joined_preprocessed_isolation_data_full_sample.rds"))
colnames(dat)
```

# Test for multicollinearity for outcome variables
Create correlation matrix to look for variables that are highly correlated.

The only variables that are highly correlated here are those that are actually measuring the same construct. For example, current depression and having a depression diagnosis. This is expected and not considered multicollinearity as these lifetime vs current measures will not be used within the same model. 

```{r test for multicollinearity for outcome variables}
# create data frame with just numeric antecedent variables
outcome_data_frame <- as.data.frame(dat[,outcome.dependent.numeric])
colnames(outcome_data_frame) <- name.list

# get correlation matrix
isolation_cor_matrix <- cor(outcome_data_frame, method = "pearson", use = "complete.obs")

reorder_cor_matrix <- function(cor_matrix){
 dd <- as.dist((1-cor_matrix)/2) #Use correlation between variables as distance
 hc <- hclust(dd)
 cormat <-cor_matrix[hc$order, hc$order]
 }

# Reorder the correlation matrix
cor_matrix_full <- reorder_cor_matrix(isolation_cor_matrix)
  
#melt the values
metled_cor_matrix <- reshape::melt(cor_matrix_full, na.rm = TRUE)

#correlation heat map
correlation_heat_map <- ggplot(metled_cor_matrix, aes(X2, X1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white",
   midpoint = 0, limit = c(-1,1), space = "Lab",
    name="Pearson\nCorrelation") +
  theme_minimal() +
  labs(y = "",
       x = "",
       title = "Correlation heat map for outcomes")+
 theme(axis.text.x = element_text(angle = 45, vjust = 1, size = 12, hjust = 1),
       axis.text.y = element_text(size = 12),
       plot.margin=grid::unit(c(0,0,0,0), "mm"),
       plot.title = element_text(size = 20),
       )+
 coord_fixed() +
  geom_text(aes(X2, X1, label = round(value, digits = 2)), color = "black", size = 3)

correlation_heat_map

#save
ggsave(
  "outcomes_correlation_heat_map.png",
  plot = correlation_heat_map,
  device = "png",
  path = paste0(graph_save_data_path, "outcomes/analysis_interpretation"),
  width = 15,
  height = 15
)
```

# Association with outcome variables at age 18

ANALYSIS PLAN 

1. **Individual outcome regressions**: single regressions are computed to see if the class can predict the the occurrence of each variable (variable ~ class). This is done through a loop. OR (Odds ratios) and their confidence intervals are calculated for binary variables (logistic regression). Standardized Beta values are calculated for continuous variables (linear regression). Continuous and binary variables are plotted separately. FDR multiple testing correction is accounted for independent tests in each block. Z scores are calculated for all contiuous variables. All linear regressions are run with raw scores and z scores.

Linear regressions (continuous variables):
depression_current_scale_18, anxiety_current_scale_18, inattentive_hyperactive_symptoms_total_18, conduct_disorder_symptoms_18, alcohol_symptom_scale_18, cannabis_symptom_scale_18,   cat_psychosis_experiences_scale_18, BMI_18, CRP_log_18, physical_activity_18, smoking_current_number_18, loneliness_18, life_satisfaction_18, technology_use_18, coping_with_stress_18, PSQI_global_score_18, job_preparedness_skills_18, job_preparedness_attributes_18, optimism_18, job_search_activities_count_18

Logistic regressions (binary variables):
depression_diagnosis_12mo_18, anxiety_diagnosis_18, ADHD_diagnosis_18, conduct_disorder_moderate_18, alcohol_dependence_18, cannabis_dependence_18, PTSD_diagnosis_lifetime_18, PTSD_diagnosis_current_18,suicide_attempt_selfharm_18, service_use_18, not_in_employment_education_numeric_18

alcohol_abuse_18 removed as using alcohol_dependence_18 instead as it captures more disordered drinking. 

2. **Pairwise comparison between increasing and decreasing class**: Individuals in the low stable class are removed. the same regressions are run to see if the class can predict the occurence of each variable (variable ~ class) with class as a binary variable (increasing/decreasing). 


# Create *z scores* for all continuous variables

```{r scale continuous variables and combine to main dataset}
# create a scaled version of the continuous variables - z scores for all variables
scaled_continuous_data <- as.data.frame(scale(dat[outcome.dependent.linear], center = TRUE, scale = TRUE))

# rename variables to show that they are z scores 
colnames(scaled_continuous_data) <- paste0("z_score.", colnames(scaled_continuous_data))

# combine the scaled data to the main dataset 
dat <- cbind(dat, scaled_continuous_data)

colnames(dat)
```

# Logistic regression

## Loop

```{r logistic regression loop}
logistic.stats.outcome <- list() #create empty list to store the information in

for (i in 1:length(outcome.dependent.logistic))
{ cat(i)
  logistic.formula.outcome <- as.formula(sprintf("%s ~ class_reordered + sex + SES_ordered", outcome.dependent.logistic[i]))

  logistic.reg.outcome <- glm(logistic.formula.outcome, data = dat, family = "binomial")

  # logistic.output.outcome.full <- broom::tidy(logistic.reg.outcome, conf.int = TRUE, exponentiate = TRUE, conf.level = 0.95)[-c(1,4:6),] %>% # delete sex and SES coefficients
  #   dplyr::rename(OR = estimate,OR.conf.low = conf.low,OR.conf.high = conf.high)
  
  # robust standard error estimation - account for non-independence of twin sample
  logistic.output.outcome.full <- summ(logistic.reg.outcome,
                                       scale = TRUE,          # standardized regression coefficients
                                       confint = TRUE,        # report confidence intervals over standard errors
                                       ci.width = 0.95,       # desired confidence interval
                                       robust = "HC0",        # heteroskedasticity-robust standard errors instead of conventional SEs
                                       cluster = "familyid",  # for clustered standard errors, provide column name of cluster variable
                                       exp = TRUE
                                       )
  
  logistic.output.outcome.full <- as.data.frame(logistic.output.outcome.full$coeftable)[-c(1,4:6),] %>% # delete sex and SES coefficients
    dplyr::select(
      OR = `exp(Est.)`,
      OR.conf.low = `2.5%`,
      OR.conf.high = `97.5%`,
      p.value = p)
    
  if (i < 11) {
    logistic.output.outcome.full <- logistic.output.outcome.full %>%
      mutate(block = "Mental health block") %>%
      mutate(Variable = outcome.dependent.logistic.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 11)) # change depending if we combine a few variables 
  } else {
   logistic.output.outcome.full <- logistic.output.outcome.full %>%
      mutate(block = "Employment block") %>%
      mutate(Variable = outcome.dependent.logistic.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.value)
  }
  
   logistic.output.outcome.full <- logistic.output.outcome.full %>% 
    mutate(
    Significance = 
      if_else(
        p.value.adjusted < 0.05, 
        1,
        0
      ) %>%
    recode_factor(
        "0" = "Non-significant",
        "1" = "Significant"
      ))
    
  logistic.stats.outcome[[i]] <- logistic.output.outcome.full
}

# set the names of the list to match the variable names
names(logistic.stats.outcome) <- outcome.dependent.logistic
```

```{r combine logistic dataframes}
data.outcome.logistic <- data.table::rbindlist(logistic.stats.outcome) %>%
  mutate(Class = rep(c("Increasing", "Decreasing"), 11)) %>% # Create new formatted class variable
  dplyr::select(Class,
         `Dependent variable` = Variable,
         OR,
         OR.conf.low,
         OR.conf.high,
         p.value, 
         p.value.adjusted,
         Significance,
         block)
```

```{r logistic regression outcome plot}
outcome.logistic.separate.plot <- ggplot(
  data.outcome.logistic, 
  aes(x = `Dependent variable`,
      y = OR,
      ymin = OR.conf.low,
      ymax = OR.conf.high,
      color = Class)
  ) +
  scale_fill_manual(values = palette2b) +
  scale_color_manual(values = palette2b) +
  scale_shape_manual(values = c(21, 19)) +
  geom_pointrange(aes(shape = Significance), position = position_dodge(width = 0.7)) +
  facet_grid(block ~ Class, drop = TRUE, scales = "free_y", space = "free") +
  labs(y = "OR (95% CI)",
       x = "names",
       title = "Association between class membership and outcomes at age 18",
       subtitle = paste("N(Total) = ", length(dat$sex),
                        "; N(Increasing) = ", sum(!is.na(dat$class_renamed[dat$class_renamed=="Increasing"])),
                        "; N(Decreasing) = ", sum(!is.na(dat$class_renamed[dat$class_renamed=="Decreasing"])), sep = ""),
       color = "",
       shape = "") +
  theme.outcome +
  geom_hline(linetype = "dashed", yintercept = 1) +
  scale_y_continuous(trans = scales::log10_trans(), breaks=c(0.2,0.4,0.6,0.8, 1, 1.5, 2, 2.5, 3, 4, 5)) +
  coord_flip()

outcome.logistic.separate.plot

#save
ggsave(
  "logistic_outcome_individual_regressions.png",
  plot = outcome.logistic.separate.plot,
  device = "png",
  path = paste0(graph_save_data_path, "outcomes/analysis_interpretation"),
  width = 10,
  height = 7
)
```

# Linear regression

## Loop

```{r linear regression loop}
linear.stats.outcome <- list() #create empty list to store the information in

for (i in 1:length(outcome.dependent.linear))
{ cat(i)
  linear.formula.outcome <- as.formula(sprintf("%s ~ class_reordered + sex + SES_ordered", outcome.dependent.linear[i]))

  linear.reg.outcome <- lm(linear.formula.outcome, data = dat)

  # linear.output.outcome.full <- broom::tidy(linear.reg.outcome, conf.int = TRUE, conf.level = 0.95)[-c(1,4:6),] # including robust standard ewrrors instead
  
  # robust standard error estimation - account for non-independence of twin sample
  linear.output.outcome.full <- broom::tidy(coeftest(linear.reg.outcome,
                                    vcov = vcovHC(linear.reg.outcome,    # estimates a robust covariance matrix
                                             type = "HC0",               # gives White's estimator 
                                             cluster = "familyid")),     # clusters by familyid
                           conf.int = TRUE, 
                           conf.level = 0.95)[-c(1,4:6),] %>%
    rename(robust.std.error = std.error) %>%
    mutate(Class = c("Increasing", "Decreasing")) # Create new formatted class variable

  if (i < 8) {
    linear.output.outcome.full <- linear.output.outcome.full %>%
      mutate(block = "Mental health block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 7))
  } else if (i < 12 ) {
   linear.output.outcome.full <- linear.output.outcome.full %>%
      mutate(block = "Physical health block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 4))
  } else if (i < 17) {
    linear.output.outcome.full <- linear.output.outcome.full %>%
      mutate(block = "Coping and functioning block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 5))
  } else {
    linear.output.outcome.full <- linear.output.outcome.full %>%
      mutate(block = "Employment block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 4))
  }
  
   linear.output.outcome.full <- linear.output.outcome.full %>% 
    mutate(
    Significance = 
      if_else(
        p.value.adjusted < 0.05, 
        1,
        0
      ) %>%
    recode_factor(
        "0" = "Non-significant",
        "1" = "Significant"
      ))
    
  linear.stats.outcome[[i]] <- linear.output.outcome.full
}
# set the names of the list to match the variable names
names(linear.stats.outcome) <- outcome.dependent.linear
```

```{r combine linear dataframes}
data.outcome.linear <- data.table::rbindlist(linear.stats.outcome) %>%
  dplyr::select(Class,
         `Dependent variable` = Variable,
         estimate,
         conf.low,
         conf.high,
         p.value, 
         p.value.adjusted,
         Significance,
         block)
```

# Linear regression using  scores

## Loop with z scores

```{r linear regression loop with z scores}
linear.stats.outcome.zscore <- list() #create empty list to store the information in

for (i in 1:length(outcome.dependent.linear.zscore))
{ cat(i)
  linear.formula.outcome.zscore <- as.formula(sprintf("%s ~ class_reordered + sex + SES_ordered", outcome.dependent.linear.zscore[i]))

  linear.reg.outcome.zscore <- lm(linear.formula.outcome.zscore, data = dat)

  # linear.output.outcome.full.zscore <- broom::tidy(linear.reg.outcome.zscore, conf.int = TRUE, conf.level = 0.95)[-c(1,4:6),] 
  
  # robust standard error estimation - account for non-independence of twin sample
  linear.output.outcome.full.zscore <- broom::tidy(coeftest(linear.reg.outcome.zscore,  # reports coefficients for new covariance matrix
                                    vcov = vcovHC(linear.reg.outcome.zscore,            # estimates a robust covariance matrix
                                             type = "HC0",                              # gives White's estimator 
                                             cluster = "familyid")),                    # clusters by familyid
                           conf.int = TRUE, 
                           conf.level = 0.95)[-c(1,4:6),] %>%
    rename(robust.std.error = std.error) %>%
    mutate(Class = c("Increasing", "Decreasing")) # Create new formatted class variable
 
  if (i < 8) {
    linear.output.outcome.full.zscore <- linear.output.outcome.full.zscore %>%
      mutate(block = "Mental health block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 11))
  } else if (i < 12 ) {
   linear.output.outcome.full.zscore <- linear.output.outcome.full.zscore %>%
      mutate(block = "Physical health block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 4))
  } else if (i < 17) {
    linear.output.outcome.full.zscore <- linear.output.outcome.full.zscore %>%
      mutate(block = "Coping and functioning block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 5))
  } else {
    linear.output.outcome.full.zscore <- linear.output.outcome.full.zscore %>%
      mutate(block = "Employment block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 4))
  }
  
   linear.output.outcome.full.zscore <- linear.output.outcome.full.zscore %>% 
    mutate(
    Significance = 
      if_else(
        p.value.adjusted < 0.05, 
        1,
        0
      ) %>%
    recode_factor(
        "0" = "Non-significant",
        "1" = "Significant"
      ))
    
  linear.stats.outcome.zscore[[i]] <- linear.output.outcome.full.zscore
}
# set the names of the list to match the variable names
names(linear.stats.outcome.zscore) <- outcome.dependent.linear.zscore
```

```{r combine linear dataframes zscore}
data.outcome.linear.zscore <- data.table::rbindlist(linear.stats.outcome.zscore) %>%
  dplyr::select(Class,
         `Dependent variable` = Variable,
         estimate,
         robust.std.error,
         conf.low,
         conf.high,
         p.value, 
         p.value.adjusted,
         Significance,
         block)
```

## Linear regression plot using z scores

```{r linear regression outcome plot zscores}
outcome.linear.separate.plot.zscore <- ggplot(
  data.outcome.linear.zscore, # CHANGE DEPENDING IF YOU WANT TO USE Z SCORES OR NOT - remember to rename the plot if you change it
  aes(x = `Dependent variable`,
      y = estimate,
      ymin = conf.low,
      ymax = conf.high,
      color = Class)
  ) +
  scale_fill_manual(values = palette2b) +
  scale_color_manual(values = palette2b) +
  scale_shape_manual(values = c(21, 19)) +
  geom_pointrange(aes(shape = Significance), position = position_dodge(width = 0.7)) +
  facet_grid(block ~ Class, drop = TRUE, scales = "free_y", space = "free") +
  labs(y = "Standardised Estimate (95% CI)",
       x = "names",
       title = "Association between childhood social isolation class membership and outcomes at age 18",
       subtitle = paste("N(Total) = ", length(dat$sex),
                        "; N(Increasing) = ", sum(!is.na(dat$class_renamed[dat$class_renamed=="Increasing"])),
                        "; N(Decreasing) = ", sum(!is.na(dat$class_renamed[dat$class_renamed=="Decreasing"])), sep = ""),
       color = "",
       shape = "") +
  theme.outcome +
  geom_hline(linetype = "dashed", yintercept = 0) +
 scale_y_continuous(breaks=c(-1.5, -1, -0.75, -0.5, -0.25, 0, 0.25, 0.5, 0.75, 1, 1.5, 2)) + # log10_trans() has been removed here
  coord_flip()

outcome.linear.separate.plot.zscore

#save
ggsave(
  "linear_outcome_individual_regressions_zscore.png",
  plot = outcome.linear.separate.plot.zscore,
  device = "png",
  path = paste0(graph_save_data_path, "outcomes/analysis_interpretation"),
  width = 12,
  height = 9
)
```
# Sex interaction

## Logistic regression loop  - sex interaction

```{r logistic regression loop with sex diffs}
logistic.stats.outcome.sex <- list() #create empty list to store the information in

for (i in 1:length(outcome.dependent.logistic))
{ cat(i)
  logistic.formula.outcome.sex <- as.formula(sprintf("%s ~ class_reordered + sex + sex*class_reordered", outcome.dependent.logistic[i]))

  logistic.reg.outcome.sex <- glm(logistic.formula.outcome.sex, data = dat, family = "binomial")

  # logistic.output.outcome.full.sex <- broom::tidy(logistic.reg.outcome.sex, conf.int = TRUE, exponentiate = TRUE, conf.level = 0.95)[-c(1:4),] %>%
  #   dplyr::rename(
  #          OR = estimate,
  #          OR.conf.low = conf.low,
  #          OR.conf.high = conf.high)
  
  # robust standard error estimation - account for non-independence of twin sample
  logistic.output.outcome.full.sex <- summ(logistic.reg.outcome.sex,
                                       scale = TRUE,          # standardized regression coefficients
                                       confint = TRUE,        # report confidence intervals over standard errors
                                       ci.width = 0.95,       # desired confidence interval
                                       robust = "HC0",        # heteroskedasticity-robust standard errors instead of conventional SEs
                                       cluster = "familyid",  # for clustered standard errors, provide column name of cluster variable
                                       exp = TRUE
                                       )
  
  logistic.output.outcome.full.sex <- as.data.frame(logistic.output.outcome.full.sex$coeftable)[-c(1:4),] %>% # delete sex and SES coefficients
    mutate(Class = c("Increasing:sex", "Decreasing:sex")) %>% # Create new formatted class variable
    dplyr::select(
      Class,
      OR = `exp(Est.)`,
      OR.conf.low = `2.5%`,
      OR.conf.high = `97.5%`,
      p.value = p)
    
 
  if (i < 11) {
    logistic.output.outcome.full.sex <- logistic.output.outcome.full.sex %>%
      mutate(block = "Mental health block") %>%
      mutate(Variable = outcome.dependent.logistic.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 7)) # change depending if we combine a few variables 
  } else {
   logistic.output.outcome.full.sex <- logistic.output.outcome.full.sex %>%
      mutate(block = "Employment block") %>%
      mutate(Variable = outcome.dependent.logistic.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.value)
  }
  
   logistic.output.outcome.full.sex <- logistic.output.outcome.full.sex %>% 
    mutate(
    Significance = 
      if_else(
        p.value.adjusted < 0.05, 
        1,
        0
      ) %>%
    recode_factor(
        "0" = "Non-significant",
        "1" = "Significant"
      ))
    
  logistic.stats.outcome.sex[[i]] <- logistic.output.outcome.full.sex
}

# set the names of the list to match the variable names
names(logistic.stats.outcome.sex) <- outcome.dependent.logistic
```

```{r combine logistic dataframes sex diffs}
data.outcome.logistic.sex <- data.table::rbindlist(logistic.stats.outcome.sex) %>% 
  dplyr::select(Class,
         `Dependent variable` = Variable,
         OR,
         OR.conf.low,
         OR.conf.high,
         p.value, 
         p.value.adjusted,
         Significance,
         block)

# check for significant interaction effects between class and sex for each variable
data.outcome.logistic.sex
```
Significant interaction between sex and class membership for "Not in employment or education" - rerun model separately for males and females. 

## Linear regression loop - sex interaction

```{r linear regression loop sex diffs}
linear.stats.outcome.sex <- list() #create empty list to store the information in

for (i in 1:length(outcome.dependent.linear))
{ cat(i)
  linear.formula.outcome.sex <- as.formula(sprintf("%s ~ class_reordered + sex + sex*class_reordered", outcome.dependent.linear[i]))

  linear.reg.outcome.sex <- lm(linear.formula.outcome.sex, data = dat)

  # linear.output.outcome.full.sex <- broom::tidy(linear.reg.outcome.sex, conf.int = TRUE, conf.level = 0.95)[-c(1:4),] 
  
  # robust standard error estimation - account for non-independence of twin sample
  linear.output.outcome.full.sex <- broom::tidy(coeftest(linear.reg.outcome.sex,      # reports coefficients for new covariance matrix
                                    vcov = vcovHC(linear.reg.outcome.sex,             # estimates a robust covariance matrix
                                             type = "HC0",                            # gives White's estimator 
                                             cluster = "familyid")),                  # clusters by familyid
                           conf.int = TRUE, 
                           conf.level = 0.95)[-c(1:4),] %>%
    rename(robust.std.error = std.error) %>%
    mutate(Class = c("Increasing:sex", "Decreasing:sex")) # Create new formatted class variable
 
  if (i < 8) {
    linear.output.outcome.full.sex <- linear.output.outcome.full.sex %>%
      mutate(block = "Mental health block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 11))
  } else if (i < 12 ) {
   linear.output.outcome.full.sex <- linear.output.outcome.full.sex %>%
      mutate(block = "Physical health block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 4))
  } else if (i < 17) {
    linear.output.outcome.full.sex <- linear.output.outcome.full.sex %>%
      mutate(block = "Coping and functioning block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 5))
  } else {
    linear.output.outcome.full.sex <- linear.output.outcome.full.sex %>%
      mutate(block = "Employment block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 4))
  }
  
   linear.output.outcome.full.sex <- linear.output.outcome.full.sex %>% 
    mutate(
    Significance = 
      if_else(
        p.value.adjusted < 0.05, 
        1,
        0
      ) %>%
    recode_factor(
        "0" = "Non-significant",
        "1" = "Significant"
      ))
    
  linear.stats.outcome.sex[[i]] <- linear.output.outcome.full.sex
}
# set the names of the list to match the variable names
names(linear.stats.outcome.sex) <- outcome.dependent.linear
```

```{r combine linear dataframes sex diffs}
data.outcome.linear.sex <- data.table::rbindlist(linear.stats.outcome.sex) %>%
  select(Class,
         `Dependent variable` = Variable,
         estimate,
         conf.low,
         conf.high,
         p.value, 
         p.value.adjusted,
         Significance,
         block)

# check for significant interactions between sex and class
data.outcome.linear.sex
```
Interaction terms are set to "class_reordered:sexFemale", therefore OR>1 indicates association with being female. 
Significant interaction between sex and class membership for "BMI". 

# Zygosity interaction

## Logistic regression loop  - zygosity interaction

```{r logistic regression loop with zyg diffs}
logistic.stats.outcome.zyg <- list() #create empty list to store the information in

for (i in 1:length(outcome.dependent.logistic))
{ cat(i)
  logistic.formula.outcome.zyg <- as.formula(sprintf("%s ~ class_reordered + zygosity_binary + zygosity_binary*class_reordered", outcome.dependent.logistic[i]))

  logistic.reg.outcome.zyg <- glm(logistic.formula.outcome.zyg, data = dat, family = "binomial")

  # logistic.output.outcome.full.zyg <- broom::tidy(logistic.reg.outcome.zyg, conf.int = TRUE, exponentiate = TRUE, conf.level = 0.95)[-c(1:4),] %>%
  #   dplyr::rename(
  #          OR = estimate,
  #          OR.conf.low = conf.low,
  #          OR.conf.high = conf.high)
  
  # robust standard error estimation - account for non-independence of twin sample
  logistic.output.outcome.full.zyg <- summ(logistic.reg.outcome.zyg,
                                       scale = TRUE,          # standardized regression coefficients
                                       confint = TRUE,        # report confidence intervals over standard errors
                                       ci.width = 0.95,       # desired confidence interval
                                       robust = "HC0",        # heteroskedasticity-robust standard errors instead of conventional SEs
                                       cluster = "familyid",  # for clustered standard errors, provide column name of cluster variable
                                       exp = TRUE
                                       )
  
  logistic.output.outcome.full.zyg <- as.data.frame(logistic.output.outcome.full.zyg$coeftable)[-c(1:4),] %>% # delete sex and SES coefficients
    mutate(Class = c("Increasing:zyg", "Decreasing:zyg")) %>% # Create new formatted class variable
    dplyr::select(
      Class,
      OR = `exp(Est.)`,
      OR.conf.low = `2.5%`,
      OR.conf.high = `97.5%`,
      p.value = p)
 
  if (i < 11) {
    logistic.output.outcome.full.zyg <- logistic.output.outcome.full.zyg %>%
      mutate(block = "Mental health block") %>%
      mutate(Variable = outcome.dependent.logistic.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 7)) # change depending if we combine a few variables 
  } else {
   logistic.output.outcome.full.zyg <- logistic.output.outcome.full.zyg %>%
      mutate(block = "Employment block") %>%
      mutate(Variable = outcome.dependent.logistic.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.value)
  }
  
   logistic.output.outcome.full.zyg <- logistic.output.outcome.full.zyg %>% 
    mutate(
    Significance = 
      if_else(
        p.value.adjusted < 0.05, 
        1,
        0
      ) %>%
    recode_factor(
        "0" = "Non-significant",
        "1" = "Significant"
      ))
    
  logistic.stats.outcome.zyg[[i]] <- logistic.output.outcome.full.zyg
}

# set the names of the list to match the variable names
names(logistic.stats.outcome.zyg) <- outcome.dependent.logistic
```

```{r combine logistic dataframes zyg diffs}
data.outcome.logistic.zyg <- data.table::rbindlist(logistic.stats.outcome.zyg) %>%
  select(Class,
         `Dependent variable` = Variable,
         OR,
         OR.conf.low,
         OR.conf.high,
         p.value, 
         p.value.adjusted,
         Significance,
         block)

# check for significant interaction effects between class and sex for each variable
data.outcome.logistic.zyg
```

No significant interaction between class membership and zygosity for any of the variables. 

## Linear regression loop - zygosity interaction

```{r linear regression loop zyg diffs}
linear.stats.outcome.zyg <- list() #create empty list to store the information in

for (i in 1:length(outcome.dependent.linear))
{ cat(i)
  linear.formula.outcome.zyg <- as.formula(sprintf("%s ~ class_reordered + zygosity_binary + zygosity_binary*class_reordered", outcome.dependent.linear[i]))

  linear.reg.outcome.zyg <- lm(linear.formula.outcome.zyg, data = dat)

  # linear.output.outcome.full.zyg <- broom::tidy(linear.reg.outcome.zyg, conf.int = TRUE, conf.level = 0.95)[-c(1:4),] 
  
  # robust standard error estimation - account for non-independence of twin sample
  linear.output.outcome.full.zyg <- broom::tidy(coeftest(linear.reg.outcome.zyg,      # reports coefficients for new covariance matrix
                                    vcov = vcovHC(linear.reg.outcome.zyg,             # estimates a robust covariance matrix
                                             type = "HC0",                            # gives White's estimator 
                                             cluster = "familyid")),                  # clusters by familyid
                           conf.int = TRUE, 
                           conf.level = 0.95)[-c(1:4),] %>%
    rename(robust.std.error = std.error) %>%
    mutate(Class = c("Increasing:zyg", "Decreasing:zyg")) # Create new formatted class variable
 
 
  if (i < 8) {
    linear.output.outcome.full.zyg <- linear.output.outcome.full.zyg %>%
      mutate(block = "Mental health block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 11))
  } else if (i < 12 ) {
   linear.output.outcome.full.zyg <- linear.output.outcome.full.zyg %>%
      mutate(block = "Physical health block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 4))
  } else if (i < 17) {
    linear.output.outcome.full.zyg <- linear.output.outcome.full.zyg %>%
      mutate(block = "Coping and functioning block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 5))
  } else {
    linear.output.outcome.full.zyg <- linear.output.outcome.full.zyg %>%
      mutate(block = "Employment block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 4))
  }
  
   linear.output.outcome.full.zyg <- linear.output.outcome.full.zyg %>% 
    mutate(
    Significance = 
      if_else(
        p.value.adjusted < 0.05, 
        1,
        0
      ) %>%
    recode_factor(
        "0" = "Non-significant",
        "1" = "Significant"
      ))
    
  linear.stats.outcome.zyg[[i]] <- linear.output.outcome.full.zyg
}
# set the names of the list to match the variable names
names(linear.stats.outcome.zyg) <- outcome.dependent.linear
```

```{r combine linear dataframes sex diffs}
data.outcome.linear.zyg <- data.table::rbindlist(linear.stats.outcome.zyg) %>%
  select(Class,
         `Dependent variable` = Variable,
         estimate,
         conf.low,
         conf.high,
         p.value, 
         p.value.adjusted,
         Significance,
         block)

# check for significant interactions between sex and class
data.outcome.linear.zyg
```
No significant interaction between class membership and zygosity for any of the variables. 

# Controlling for significant antecedents

Rerun all regression models while controlling for antecedents that remained significant in the full antecedent model. Antecedents that remained significant in the full antecedent model:child prosocial behaviours, ADHD behaviours, internalising behaviours, and child executive function 

## Logistic regression loop - controlling for antecedents

```{r logistic regression loop}
logistic.stats.outcome.ant_control <- list() #create empty list to store the information in

for (i in 1:length(outcome.dependent.logistic))
{ cat(i)
  logistic.formula.outcome.ant_control <- as.formula(sprintf("%s ~ class_reordered + prosocial_behaviours_combined_05 + ADHD_combined_05 + internalising_combined_excl_sis_05 + executive_function_05 + sex + SES_ordered", outcome.dependent.logistic[i]))

  logistic.reg.outcome.ant_control <- glm(logistic.formula.outcome.ant_control, data = dat, family = "binomial")

  # logistic.output.outcome.full.ant_control <- broom::tidy(logistic.reg.outcome.ant_control, conf.int = TRUE, exponentiate = TRUE, conf.level = 0.95)[-c(1,4:10),] %>%
  #   dplyr::rename(
  #          OR = estimate,
  #          OR.conf.low = conf.low,
  #          OR.conf.high = conf.high)
  
  logistic.output.outcome.full.ant_control <- summ(logistic.reg.outcome.ant_control,
                                       scale = TRUE,          # standardized regression coefficients
                                       confint = TRUE,        # report confidence intervals over standard errors
                                       ci.width = 0.95,       # desired confidence interval
                                       robust = "HC0",        # heteroskedasticity-robust standard errors instead of conventional SEs
                                       cluster = "familyid",  # for clustered standard errors, provide column name of cluster variable
                                       exp = TRUE
                                       )
  
  logistic.output.outcome.full.ant_control <- as.data.frame(logistic.output.outcome.full.ant_control$coeftable)[-c(1,4:10),] %>% # delete sex and SES coefficients
    mutate(Class = c("Increasing", "Decreasing")) %>% # Create new formatted class variable
    dplyr::select(
      Class,
      OR = `exp(Est.)`,
      OR.conf.low = `2.5%`,
      OR.conf.high = `97.5%`,
      p.value = p)
 
  if (i < 11) {
    logistic.output.outcome.full.ant_control <- logistic.output.outcome.full.ant_control %>%
      mutate(block = "Mental health block") %>%
      mutate(Variable = outcome.dependent.logistic.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 7)) # change depending if we combine a few variables 
  } else {
   logistic.output.outcome.full.ant_control <- logistic.output.outcome.full.ant_control %>%
      mutate(block = "Employment block") %>%
      mutate(Variable = outcome.dependent.logistic.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.value)
  }
  
   logistic.output.outcome.full.ant_control <- logistic.output.outcome.full.ant_control %>% 
    mutate(
    Significance = 
      if_else(
        p.value.adjusted < 0.05, 
        1,
        0
      ) %>%
    recode_factor(
        "0" = "Non-significant",
        "1" = "Significant"
      ))
    
  logistic.stats.outcome.ant_control[[i]] <- logistic.output.outcome.full.ant_control
}

# set the names of the list to match the variable names
names(logistic.stats.outcome.ant_control) <- outcome.dependent.logistic
```

```{r combine logistic dataframes ant control}
data.outcome.logistic.ant_control <- data.table::rbindlist(logistic.stats.outcome.ant_control) %>%
  select(Class,
         `Dependent variable` = Variable,
         OR,
         OR.conf.low,
         OR.conf.high,
         p.value, 
         p.value.adjusted,
         Significance,
         block)
```

```{r table for logistic dataframes ant control}
kable(data.outcome.logistic.ant_control)
```

### Logistic regression plot - controlling for antecedents

```{r logistic regression outcome plot ant control}
outcome.logistic.separate.plot.ant_control <- ggplot(
  data.outcome.logistic.ant_control, 
  aes(x = `Dependent variable`,
      y = OR,
      ymin = OR.conf.low,
      ymax = OR.conf.high,
      color = Class)
  ) +
  scale_fill_manual(values = palette2b) +
  scale_color_manual(values = palette2b) +
  scale_shape_manual(values = c(21, 19)) +
  geom_pointrange(aes(shape = Significance), position = position_dodge(width = 0.7)) +
  facet_grid(block ~ Class, drop = TRUE, scales = "free_y", space = "free") +
  labs(y = "OR (95% CI)",
       x = "names",
       title = "Association betweenclass membership and outcomes at age 18",
       subtitle = paste("N(Total) = ", length(dat$sex),
                        "; N(Increasing) = ", sum(!is.na(dat$class_renamed[dat$class_renamed=="Increasing"])),
                        "; N(Decreasing) = ", sum(!is.na(dat$class_renamed[dat$class_renamed=="Decreasing"])), sep = ""),
       color = "",
       shape = "") +
  theme.outcome +
  geom_hline(linetype = "dashed", yintercept = 1) +
  scale_y_continuous(trans = scales::log10_trans(), breaks=c(0.2,0.4,0.6,0.8, 1, 1.5, 2, 2.5, 3, 4, 5)) +
  coord_flip()

outcome.logistic.separate.plot.ant_control

#save
ggsave(
  "logistic_outcome_individual_regressions.ant_control.png",
  plot = outcome.logistic.separate.plot.ant_control,
  device = "png",
  path = paste0(graph_save_data_path, "outcomes/analysis_interpretation"),
  width = 12,
  height = 9
)
```

## Linear regression loop using z scores - controlling for antecedents

```{r linear regression loop zscore ant control}
linear.stats.outcome.zscore.ant_control <- list() #create empty list to store the information in

for (i in 1:length(outcome.dependent.linear.zscore))
{ cat(i)
  linear.formula.outcome.zscore.ant_control <- as.formula(sprintf("%s ~ class_reordered + prosocial_behaviours_combined_05 + ADHD_combined_05 + internalising_combined_excl_sis_05 + executive_function_05 + sex + SES_ordered", outcome.dependent.linear.zscore[i]))

  linear.reg.outcome.zscore.ant_control <- lm(linear.formula.outcome.zscore.ant_control, data = dat)

  # linear.output.outcome.full.zscore.ant_control <- broom::tidy(linear.reg.outcome.zscore.ant_control, conf.int = TRUE, conf.level = 0.95)[-c(1,4:10),] 
  
  # robust standard error estimation - account for non-independence of twin sample
  linear.output.outcome.full.zscore.ant_control <- broom::tidy(coeftest(linear.reg.outcome.zscore.ant_control,      # reports coefficients for new covariance matrix
                                    vcov = vcovHC(linear.reg.outcome.zscore.ant_control,             # estimates a robust covariance matrix
                                             type = "HC0",                                           # gives White's estimator 
                                             cluster = "familyid")),                                 # clusters by familyid
                           conf.int = TRUE, 
                           conf.level = 0.95)[-c(1,4:10),]  %>%
    rename(robust.std.error = std.error) %>%
    mutate(Class = c("Increasing", "Decreasing")) # Create new formatted class variable
 
  if (i < 8) {
    linear.output.outcome.full.zscore.ant_control <- linear.output.outcome.full.zscore.ant_control %>%
      mutate(block = "Mental health block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 11))
  } else if (i < 12 ) {
   linear.output.outcome.full.zscore.ant_control <- linear.output.outcome.full.zscore.ant_control %>%
      mutate(block = "Physical health block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 4))
  } else if (i < 17) {
    linear.output.outcome.full.zscore.ant_control <- linear.output.outcome.full.zscore.ant_control %>%
      mutate(block = "Coping and functioning block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 5))
  } else {
    linear.output.outcome.full.zscore.ant_control <- linear.output.outcome.full.zscore.ant_control %>%
      mutate(block = "Employment block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 4))
  }
  
   linear.output.outcome.full.zscore.ant_control <- linear.output.outcome.full.zscore.ant_control %>% 
    mutate(
    Significance = 
      if_else(
        p.value.adjusted < 0.05, 
        1,
        0
      ) %>%
    recode_factor(
        "0" = "Non-significant",
        "1" = "Significant"
      ))
    
  linear.stats.outcome.zscore.ant_control[[i]] <- linear.output.outcome.full.zscore.ant_control
}
# set the names of the list to match the variable names
names(linear.stats.outcome.zscore.ant_control) <- outcome.dependent.linear.zscore
```

```{r combine linear dataframes zscore ant control}
data.outcome.linear.zscore.ant_control <- data.table::rbindlist(linear.stats.outcome.zscore.ant_control) %>%
  select(Class,
         `Dependent variable` = Variable,
         estimate,
         conf.low,
         conf.high,
         p.value, 
         p.value.adjusted,
         Significance,
         block)
```

```{r table linear dataframes zscore ant control}
kable(data.outcome.linear.zscore.ant_control)
```

### Linear regression plot with z scores - controlling for antecedents

```{r linear regression outcome plot zscore ant control}
outcome.linear.separate.plot.zscore.ant_control <- ggplot(
  data.outcome.linear.zscore.ant_control, 
  aes(x = `Dependent variable`,
      y = estimate,
      ymin = conf.low,
      ymax = conf.high,
      color = Class)
  ) +
  scale_fill_manual(values = palette2b) +
  scale_color_manual(values = palette2b) +
  scale_shape_manual(values = c(21, 19)) +
  geom_pointrange(aes(shape = Significance), position = position_dodge(width = 0.7)) +
  facet_grid(block ~ Class, drop = TRUE, scales = "free_y", space = "free") +
  labs(y = "Standardised Estimate (95% CI)",
       x = "names",
       title = "Association between lass membership and outcomes at age 18",
       subtitle = paste("N(Total) = ", length(dat$sex),
                        "; N(Increasing) = ", sum(!is.na(dat$class_renamed[dat$class_renamed=="Increasing"])),
                        "; N(Decreasing) = ", sum(!is.na(dat$class_renamed[dat$class_renamed=="Decreasing"])), sep = ""),
       color = "",
       shape = "") +
  theme.outcome +
  geom_hline(linetype = "dashed", yintercept = 0) +
 scale_y_continuous(breaks=c(-1.5, -1, -0.75, -0.5, -0.25, 0, 0.25, 0.5, 0.75, 1, 1.5, 2)) + # log10_trans() has been removed here
  coord_flip()

outcome.linear.separate.plot.zscore.ant_control

#save
ggsave(
  "linear_outcome_individual_regressions_zscore.ant_control.png",
  plot = outcome.linear.separate.plot.zscore.ant_control,
  device = "png",
  path = paste0(graph_save_data_path, "outcomes/analysis_interpretation"),
  width = 12,
  height = 9
)
```

# Pairwise comparisons

We first attempted to run pairwise comparisons between increasing and decreasing classes for the antecedents but then decided this doesn't make sense for antecedents - as it is only measuring the differences in the intercept rather than the slope. Therefore, pairwise comparisons makes more logical sense for outcome variables as we can test for differences in slope and intercept. 

## Create new dataset dropping those who are in the lowstable class 

```{r create pairwise dataset and order class variable}
dat.pairwise <- dat %>%
  filter(class_renamed != "Low stable") %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Low stable"))

dat.pairwise <- dat.pairwise %>%
  mutate(
    class_binary =
      as.factor(class_renamed) %>%
      relevel(ref = "Decreasing",
              first = TRUE,
              collapse = "+",
              xlevels = TRUE)
  )
```

## Run the same regressions for the pairwise data set

### Logistic

```{r logistic regression loop pairwise}
logistic.stats.outcome.pairwise <- list() #create empty list to store the information in

for (i in 1:length(outcome.dependent.logistic))
{ cat(i)
  logistic.formula.outcome.pairwise <- as.formula(sprintf("%s ~ class_binary + sex + SES_ordered", outcome.dependent.logistic[i]))

  logistic.reg.outcome.pairwise <- glm(logistic.formula.outcome.pairwise, data = dat.pairwise, family = "binomial")

  # logistic.output.outcome.full.pairwise <- broom::tidy(logistic.reg.outcome.pairwise, conf.int = TRUE, exponentiate = TRUE, conf.level = 0.95)[-c(1,3:5),] %>%
  #   dplyr::rename(
  #          OR = estimate,
  #          OR.conf.low = conf.low,
  #          OR.conf.high = conf.high)
  
  logistic.output.outcome.full.pairwise <- summ(logistic.reg.outcome.pairwise,
                                       scale = TRUE,          # standardized regression coefficients
                                       confint = TRUE,        # report confidence intervals over standard errors
                                       ci.width = 0.95,       # desired confidence interval
                                       robust = "HC0",        # heteroskedasticity-robust standard errors instead of conventional SEs
                                       cluster = "familyid",  # for clustered standard errors, provide column name of cluster variable
                                       exp = TRUE
                                       )
  
  logistic.output.outcome.full.pairwise <- as.data.frame(logistic.output.outcome.full.pairwise$coeftable)[-c(1,3:5),] %>% # delete sex and SES coefficients
    mutate(Class = c("Increasing")) %>% # Create new formatted class variable - decreasing class is the comparison group 
    dplyr::select(
      Class,
      OR = `exp(Est.)`,
      OR.conf.low = `2.5%`,
      OR.conf.high = `97.5%`,
      p.value = p)
 
  if (i < 11) {
    logistic.output.outcome.full.pairwise <- logistic.output.outcome.full.pairwise %>%
      mutate(block = "Mental health block") %>%
      mutate(Variable = outcome.dependent.logistic.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 7)) # change depending if we combine a few variables 
  } else {
   logistic.output.outcome.full.pairwise <- logistic.output.outcome.full.pairwise %>%
      mutate(block = "Employment block") %>%
      mutate(Variable = outcome.dependent.logistic.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.value)
  }
  
   logistic.output.outcome.full.pairwise <- logistic.output.outcome.full.pairwise %>% 
    mutate(
    Significance = 
      if_else(
        p.value.adjusted < 0.05, 
        1,
        0
      ) %>%
    recode_factor(
        "0" = "Non-significant",
        "1" = "Significant"
      ))
    
  logistic.stats.outcome.pairwise[[i]] <- logistic.output.outcome.full.pairwise
}

# set the names of the list to match the variable names
names(logistic.stats.outcome.pairwise) <- outcome.dependent.logistic
```
The decreasing class is the comparison group - all OR > 1 represent an association with the increasing class. 

```{r combine logistic dataframes pairwise}
data.outcome.logistic.pairwise <- data.table::rbindlist(logistic.stats.outcome.pairwise) %>%
  select(Class,
         `Dependent variable` = Variable,
         OR,
         OR.conf.low,
         OR.conf.high,
         p.value, 
         p.value.adjusted,
         Significance,
         block)
```

```{r table logistic dataframes pairwise}
kable(data.outcome.logistic.pairwise)
```

```{r logistic regression outcome plot pairwise}
outcome.logistic.separate.pairwise.plot <- ggplot(
  data.outcome.logistic.pairwise, 
  aes(x = `Dependent variable`,
      y = OR,
      ymin = OR.conf.low,
      ymax = OR.conf.high,
      color = Class)
  ) +
  scale_fill_manual(values = palette2b) +
  scale_color_manual(values = palette2b) +
  scale_shape_manual(values = c(21, 19)) +
  geom_pointrange(aes(shape = Significance), position = position_dodge(width = 0.7)) +
  facet_grid(block ~ ., drop = TRUE, scales = "free_y", space = "free") +
  labs(y = "OR (95% CI) \n OR>1 indicates association with Increasing compared to Decreasing",
       x = "names",
       title = "Pairwise comparison between class membership and outcomes at age 18",
       subtitle = paste("N(Total) = ", length(dat$sex),
                        "; N(Increasing) = ", sum(!is.na(dat$class_renamed[dat$class_renamed=="Increasing"])),
                        "; N(Decreasing) = ", sum(!is.na(dat$class_renamed[dat$class_renamed=="Decreasing"])), sep = ""),
       color = "",
       shape = "") +
  theme.outcome +
  geom_hline(linetype = "dashed", yintercept = 1) +
  scale_y_continuous(trans = scales::log10_trans(), breaks=c(0.2,0.4,0.6,0.8, 1, 2, 3, 4, 5)) +
  coord_flip()

outcome.logistic.separate.pairwise.plot

#save
ggsave(
  "logistic_pairwise_outcome_individual_regressions.png",
  plot = outcome.logistic.separate.pairwise.plot,
  device = "png",
  path = paste0(graph_save_data_path, "outcomes/analysis_interpretation"),
  width = 12,
  height = 9
)
```

### Linear - using z scores

```{r linear pairwise regression loop using zscores}
linear.stats.outcome.zscore.pairwise <- list() #create empty list to store the information in

for (i in 1:length(outcome.dependent.linear.zscore))
{ cat(i)
  linear.formula.outcome.zscore.pairwise <- as.formula(sprintf("%s ~ class_binary + sex + SES_ordered", outcome.dependent.linear.zscore[i]))

  linear.reg.outcome.zscore.pairwise <- lm(linear.formula.outcome.zscore.pairwise, data = dat.pairwise)

  # linear.output.outcome.full.zscore.pairwise <- broom::tidy(linear.reg.outcome.zscore.pairwise, conf.int = TRUE, conf.level = 0.95)[-c(1,3:5),]
  
  # robust standard error estimation - account for non-independence of twin sample
  linear.output.outcome.full.zscore.pairwise <- broom::tidy(coeftest(linear.reg.outcome.zscore.pairwise,      # reports coefficients for new covariance matrix
                                    vcov = vcovHC(linear.reg.outcome.zscore.pairwise,             # estimates a robust covariance matrix
                                             type = "HC0",                                           # gives White's estimator 
                                             cluster = "familyid")),                                 # clusters by familyid
                           conf.int = TRUE, 
                           conf.level = 0.95)[-c(1,3:5),]  %>%
    rename(robust.std.error = std.error) %>%
    mutate(Class = c("Increasing")) # Create new formatted class variable - decreasing is the comparison group
 
  if (i < 8) {
    linear.output.outcome.full.zscore.pairwise <- linear.output.outcome.full.zscore.pairwise %>%
      mutate(block = "Mental health block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 11))
  } else if (i < 12 ) {
   linear.output.outcome.full.zscore.pairwise <- linear.output.outcome.full.zscore.pairwise %>%
      mutate(block = "Physical health block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 4))
  } else if (i < 17) {
    linear.output.outcome.full.zscore.pairwise <- linear.output.outcome.full.zscore.pairwise %>%
      mutate(block = "Coping and functioning block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 5))
  } else {
    linear.output.outcome.full.zscore.pairwise <- linear.output.outcome.full.zscore.pairwise %>%
      mutate(block = "Employment block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 4))
  }
  
   linear.output.outcome.full.zscore.pairwise <- linear.output.outcome.full.zscore.pairwise %>% 
    mutate(
    Significance = 
      if_else(
        p.value.adjusted < 0.05, 
        1,
        0
      ) %>%
    recode_factor(
        "0" = "Non-significant",
        "1" = "Significant"
      ))
    
  linear.stats.outcome.zscore.pairwise[[i]] <- linear.output.outcome.full.zscore.pairwise
}

# set the names of the list to match the variable names
names(linear.stats.outcome.zscore.pairwise) <- outcome.dependent.linear.zscore
```

```{r combine linear dataframes}
data.outcome.linear.zscore.pairwise <- data.table::rbindlist(linear.stats.outcome.zscore.pairwise) %>%
  select(Class,
         `Dependent variable` = Variable,
         estimate,
         conf.low,
         conf.high,
         p.value, 
         p.value.adjusted,
         Significance,
         block)
```

```{r linear regression pairwise outcome plot}
outcome.linear.separate.plot.zscore.pairwise <- ggplot(
  data.outcome.linear.zscore.pairwise, 
  aes(x = `Dependent variable`,
      y = estimate,
      ymin = conf.low,
      ymax = conf.high,
      color = Class)
  ) +
  scale_fill_manual(values = palette2b) +
  scale_color_manual(values = palette2b) +
  scale_shape_manual(values = c(21, 19)) +
  geom_pointrange(aes(shape = Significance), position = position_dodge(width = 0.7)) +
  facet_grid(block ~ ., drop = TRUE, scales = "free_y", space = "free") +
  labs(y = "Standardised Estimate (95% CI) \n >0 indicates association with Increasing compared to Decreasing",
       x = "names",
       title = "Pairwise comparison between class membership and outcomes at age 18",
       subtitle = paste("N(Total) = ", length(dat$sex),
                        "; N(Increasing) = ", sum(!is.na(dat$class_renamed[dat$class_renamed=="Increasing"])),
                        "; N(Decreasing) = ", sum(!is.na(dat$class_renamed[dat$class_renamed=="Decreasing"])), sep = ""),
       color = "",
       shape = "") +
  theme.outcome +
  geom_hline(linetype = "dashed", yintercept = 0) +
 scale_y_continuous(breaks=c(-1.5, -1, -0.75, -0.5, -0.25, 0, 0.25, 0.5, 0.75, 1, 1.5, 2)) + # log10_trans() has been removed here
  coord_flip()

outcome.linear.separate.plot.zscore.pairwise

#save
ggsave(
  "linear_outcome_individual_regressions_zscore_pairwise.png",
  plot = outcome.linear.separate.plot.zscore.pairwise,
  device = "png",
  path = paste0(graph_save_data_path, "outcomes/analysis_interpretation"),
  width = 12,
  height = 9
)
```

## Pairwise comparisons controlling for antecedents

### Logistic regression - pairwise comparison controlling for antecedents

```{r logistic regression loop pairwise control antecedent}
logistic.stats.outcome.pairwise.ant_control <- list() #create empty list to store the information in

for (i in 1:length(outcome.dependent.logistic))
{ cat(i)
  logistic.formula.outcome.pairwise.ant_control <- as.formula(sprintf("%s ~ class_binary + prosocial_behaviours_combined_05 + ADHD_combined_05 + internalising_combined_excl_sis_05 + executive_function_05 + sex + SES_ordered", outcome.dependent.logistic[i]))

  logistic.reg.outcome.pairwise.ant_control <- glm(logistic.formula.outcome.pairwise.ant_control, data = dat.pairwise, family = "binomial")

  # logistic.output.outcome.full.pairwise.ant_control <- broom::tidy(logistic.reg.outcome.pairwise.ant_control, conf.int = TRUE, exponentiate = TRUE, conf.level = 0.95)[-c(1,3:6),] %>%
  #   dplyr::rename(
  #          OR = estimate,
  #          OR.conf.low = conf.low,
  #          OR.conf.high = conf.high)
  
  logistic.output.outcome.full.pairwise.ant_control <- summ(logistic.reg.outcome.pairwise.ant_control,
                                       scale = TRUE,          # standardized regression coefficients
                                       confint = TRUE,        # report confidence intervals over standard errors
                                       ci.width = 0.95,       # desired confidence interval
                                       robust = "HC0",        # heteroskedasticity-robust standard errors instead of conventional SEs
                                       cluster = "familyid",  # for clustered standard errors, provide column name of cluster variable
                                       exp = TRUE
                                       )
  
  logistic.output.outcome.full.pairwise.ant_control <- as.data.frame(logistic.output.outcome.full.pairwise.ant_control$coeftable)[-c(1,3:9),] %>% # delete sex and SES coefficients
    mutate(Class = c("Increasing")) %>% # Create new formatted class variable - decreasing class is the comparison group 
    dplyr::select(
      Class,
      OR = `exp(Est.)`,
      OR.conf.low = `2.5%`,
      OR.conf.high = `97.5%`,
      p.value = p)
 
  if (i < 11) {
    logistic.output.outcome.full.pairwise.ant_control <- logistic.output.outcome.full.pairwise.ant_control %>%
      mutate(block = "Mental health block") %>%
      mutate(Variable = outcome.dependent.logistic.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 7)) # change depending if we combine a few variables 
  } else {
   logistic.output.outcome.full.pairwise.ant_control <- logistic.output.outcome.full.pairwise.ant_control %>%
      mutate(block = "Employment block") %>%
      mutate(Variable = outcome.dependent.logistic.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.value)
  }
  
   logistic.output.outcome.full.pairwise.ant_control <- logistic.output.outcome.full.pairwise.ant_control %>% 
    mutate(
    Significance = 
      if_else(
        p.value.adjusted < 0.05, 
        1,
        0
      ) %>%
    recode_factor(
        "0" = "Non-significant",
        "1" = "Significant"
      ))
    
  logistic.stats.outcome.pairwise.ant_control[[i]] <- logistic.output.outcome.full.pairwise.ant_control
}

# set the names of the list to match the variable names
names(logistic.stats.outcome.pairwise.ant_control) <- outcome.dependent.logistic
```

```{r combine logistic dataframes pairwise control antecedent}
data.outcome.logistic.pairwise.ant_control <- data.table::rbindlist(logistic.stats.outcome.pairwise.ant_control) %>%
  select(Class,
         `Dependent variable` = Variable,
         OR,
         OR.conf.low,
         OR.conf.high,
         p.value, 
         p.value.adjusted,
         Significance,
         block)
```

```{r logistic regression pairwise outcome plot pairwise control antecedent}
outcome.logistic.separate.pairwise.plot.ant_control <- ggplot(
  data.outcome.logistic.pairwise.ant_control, 
  aes(x = `Dependent variable`,
      y = OR,
      ymin = OR.conf.low,
      ymax = OR.conf.high,
      color = Class)
  ) +
  scale_fill_manual(values = palette2b) +
  scale_color_manual(values = palette2b) +
  scale_shape_manual(values = c(21, 19)) +
  geom_pointrange(aes(shape = Significance), position = position_dodge(width = 0.7)) +
  facet_grid(block ~ ., drop = TRUE, scales = "free_y", space = "free") +
  labs(y = "OR (95% CI) \n OR>1 indicates association with Increasing compared to Decreasing",
       x = "names",
       title = "Pairwise comparison between childhood social isolation class membership and outcomes at age 18",
       subtitle = paste("N(Total) = ", length(dat$sex),
                        "; N(Increasing) = ", sum(!is.na(dat$class_renamed[dat$class_renamed=="Increasing"])),
                        "; N(Decreasing) = ", sum(!is.na(dat$class_renamed[dat$class_renamed=="Decreasing"])), sep = ""),
       color = "",
       shape = "") +
  theme.outcome +
  geom_hline(linetype = "dashed", yintercept = 1) +
  scale_y_continuous(trans = scales::log10_trans(), breaks=c(0.2,0.4,0.6,0.8, 1, 1.5, 2, 2.5, 3)) +
  coord_flip()

outcome.logistic.separate.pairwise.plot.ant_control

#save
ggsave(
  "logistic_pairwise_outcome_individual_regressions.ant_control.png",
  plot = outcome.logistic.separate.pairwise.plot.ant_control,
  device = "png",
  path = paste0(graph_save_data_path, "outcomes/analysis_interpretation"),
  width = 12,
  height = 9
)
```

### Linear regressions - using z scores controlling for antecedents

```{r linear pairwise regression loop using zscores pairwise control antecedent}
linear.stats.outcome.zscore.pairwise.ant_control <- list() #create empty list to store the information in

for (i in 1:length(outcome.dependent.linear.zscore))
{ cat(i)
  linear.formula.outcome.zscore.pairwise.ant_control <- as.formula(sprintf("%s ~ class_binary + prosocial_behaviours_combined_05 + ADHD_combined_05 + internalising_combined_excl_sis_05 + executive_function_05 + sex + SES_ordered", outcome.dependent.linear.zscore[i]))

  linear.reg.outcome.zscore.pairwise.ant_control <- lm(linear.formula.outcome.zscore.pairwise.ant_control, data = dat.pairwise)

  # linear.output.outcome.full.zscore.pairwise.ant_control <- broom::tidy(linear.reg.outcome.zscore.pairwise.ant_control, conf.int = TRUE, conf.level = 0.95)[-c(1,3:6),]
  
  # robust standard error estimation - account for non-independence of twin sample
  linear.output.outcome.full.zscore.pairwise.ant_control <- broom::tidy(coeftest(linear.reg.outcome.zscore.pairwise.ant_control,      # reports coefficients for new covariance matrix
                                    vcov = vcovHC(linear.reg.outcome.zscore.pairwise.ant_control,             # estimates a robust covariance matrix
                                             type = "HC0",                                           # gives White's estimator 
                                             cluster = "familyid")),                                 # clusters by familyid
                           conf.int = TRUE, 
                           conf.level = 0.95)[-c(1,3:9),]  %>%
    rename(robust.std.error = std.error) %>%
    mutate(Class = c("Increasing")) # Create new formatted class variable - decreasing is the comparison group
 
  if (i < 8) {
    linear.output.outcome.full.zscore.pairwise.ant_control <- linear.output.outcome.full.zscore.pairwise.ant_control %>%
      mutate(block = "Mental health block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 11))
  } else if (i < 12 ) {
   linear.output.outcome.full.zscore.pairwise.ant_control <- linear.output.outcome.full.zscore.pairwise.ant_control %>%
      mutate(block = "Physical health block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 4))
  } else if (i < 17) {
    linear.output.outcome.full.zscore.pairwise.ant_control <- linear.output.outcome.full.zscore.pairwise.ant_control %>%
      mutate(block = "Coping and functioning block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 5))
  } else {
    linear.output.outcome.full.zscore.pairwise.ant_control <- linear.output.outcome.full.zscore.pairwise.ant_control %>%
      mutate(block = "Employment block") %>%
      mutate(Variable = outcome.dependent.linear.name.list[[i]]) %>%
                  mutate(p.value.adjusted = p.adjust(p.value, method = "fdr", n = 4))
  }
  
   linear.output.outcome.full.zscore.pairwise.ant_control <- linear.output.outcome.full.zscore.pairwise.ant_control %>% 
    mutate(
    Significance = 
      if_else(
        p.value.adjusted < 0.05, 
        1,
        0
      ) %>%
    recode_factor(
        "0" = "Non-significant",
        "1" = "Significant"
      ))
    
  linear.stats.outcome.zscore.pairwise.ant_control[[i]] <- linear.output.outcome.full.zscore.pairwise.ant_control
}

# set the names of the list to match the variable names
names(linear.stats.outcome.zscore.pairwise.ant_control) <- outcome.dependent.linear.zscore
```

```{r combine linear dataframes pairwise control antecedent}
data.outcome.linear.zscore.pairwise.ant_control <- data.table::rbindlist(linear.stats.outcome.zscore.pairwise.ant_control) %>%
  select(Class,
         `Dependent variable` = Variable,
         estimate,
         conf.low,
         conf.high,
         p.value, 
         p.value.adjusted,
         Significance,
         block)
```

```{r linear regression pairwise outcome plot pairwise control antecedent}
outcome.linear.separate.plot.zscore.pairwise.ant_control <- ggplot(
  data.outcome.linear.zscore.pairwise.ant_control, 
  aes(x = `Dependent variable`,
      y = estimate,
      ymin = conf.low,
      ymax = conf.high,
      color = Class)
  ) +
  scale_fill_manual(values = palette2b) +
  scale_color_manual(values = palette2b) +
  scale_shape_manual(values = c(21, 19)) +
  geom_pointrange(aes(shape = Significance), position = position_dodge(width = 0.7)) +
  facet_grid(block ~ ., drop = TRUE, scales = "free_y", space = "free") +
  labs(y = "Standardised Estimate (95% CI) \n >0 indicates association with Increasing compared to Decreasing",
       x = "names",
       title = "Pairwise comparison between childhood social isolation class membership and outcomes at age 18",
       subtitle = paste("N(Total) = ", length(dat$sex),
                        "; N(Increasing) = ", sum(!is.na(dat$class_renamed[dat$class_renamed=="Increasing"])),
                        "; N(Decreasing) = ", sum(!is.na(dat$class_renamed[dat$class_renamed=="Decreasing"])), sep = ""),
       color = "",
       shape = "") +
  theme.outcome +
  geom_hline(linetype = "dashed", yintercept = 0) +
 scale_y_continuous(breaks=c(-1.5, -1, -0.75, -0.5, -0.25, 0, 0.25, 0.5, 0.75, 1, 1.5, 2)) + # log10_trans() has been removed here
  coord_flip()

outcome.linear.separate.plot.zscore.pairwise.ant_control

#save
ggsave(
  "linear_outcome_individual_regressions_zscore_pairwise.ant_control.png",
  plot = outcome.linear.separate.plot.zscore.pairwise.ant_control,
  device = "png",
  path = paste0(graph_save_data_path, "outcomes/analysis_interpretation"),
  width = 12,
  height = 9
)
```


